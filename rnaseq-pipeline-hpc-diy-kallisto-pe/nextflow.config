/*
 * Default params
 */
params.reads = "${projectDir}/data/paired-end.csv"
params.transcriptome = "${projectDir}/data/aligned/homo-genome.idx"
params.outdir = "results"
params.outimages = "images"
params.report_id = "all_paired-end"

/*
 * Defines resource allocation for different processes 
 */

process {
  // Default resources for lightweight tasks
  // FASTQC and MULTIQC 
  cpus = 2
  memory = 2.GB
  maxRetries = 2 // retry failed tasks up to 2 times
  errorStrategy = 'retry' // retry on failure
  // time = '30m'

  withName: 'TRIM_GALORE' {
    scratch = true
    cpus = 8
    memory = 12.GB
    maxRetries = 2
    errorStrategy = 'retry'
    // time = '1h'
  }

  withName: 'KALLISTO_QUAN' {
    scratch = true
    cpus = 8
    memory = 24.GB  
    maxRetries = 2
    errorStrategy = 'retry'
    // time = '1h'
  }
}

/*
 * Defines execution profiles for different environments
 */

profiles {
  'docker' {
    docker.enabled = true
  }

  'unavcluster' {
    singularity.enabled = true
    singularity.cacheDir = "${params.outimages}" 
    process.executor = 'slurm'
    process.queue = 'short'
  }

  'batch' {
    docker.enabled = true
    process.executor = 'awsbatch'
    process.queue = 'nf-queue'
    workDir = 's3://nextflow-for-rnaseq/test_env'
    aws.region = 'eu-west-1'
    aws.batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
  }
}

/*
 * Defines the output folder of the report, timeline, and trace files
 */

report {
    enabled = true
    file    = "${params.outdir}/report.html"
}
timeline {
    enabled = true
    file    = "${params.outdir}/timeline.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/trace.txt"
}